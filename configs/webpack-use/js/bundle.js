!function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=4)}([function(t,e,s){"use strict"},function(t,e,s){"use strict";function i(t){this.letter=t.letter.toUpperCase(),this.index={x:t.x,y:t.y};var e=i.border;this.x=this.index.x*i.size-.5*e,this.y=this.index.y*i.size-.5*e,this.clearX=this.x-.5*i.border,this.clearY=this.y-.5*i.border,this.clearSize=i.size+i.border,this.centerX=this.x+i.size/2,this.centerY=this.y+i.size/2,this.$=document.createElement("div"),this.$.style="position: absolute; top: "+(this.clearY+t.padding)+"px; left: "+(this.clearX+t.padding)+"px; width: "+this.clearSize+"px; height: "+this.clearSize+"px"}Object.defineProperty(e,"__esModule",{value:!0}),i.ctx=null,i.border=2,i.size=60,i.prototype.draw=function(t,e){i.ctx.strokeStyle=t,i.ctx.clearRect(this.clearX,this.clearY,this.clearSize,this.clearSize),i.ctx.strokeRect(this.x,this.y,i.size,i.size),i.ctx.strokeStyle=e,i.ctx.fillText(this.letter,this.centerX,this.centerY,i.size)},i.prototype.update=function(t,e){i.ctx.save(),this.draw(t,e),i.ctx.restore()},e.default=i},function(t,s,i){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var r,n=i(1),o=(r=n)&&r.__esModule?r:{default:r};var l={$:null,canvas:null,ctx:null,mainBorderColor:"#eee",mainTextColor:"black",selectedBorderColor:"teal",selectedTextColor:"teal",hintBorderColor:"teal",hintTextColor:"teal",canvasPadding:30,getCoords:null,border:2,size:60,letters:[],cells:[],currentSelection:[],currentCell:null,prevCell:null,currentWord:"",guessedWords:[],$words:[],count:0,lastWrongWord:"",wrongAttemptsCount:0,wrongAttemptsForDisplayMessage:3,lastPathErrorWord:"",pathErrorAttemptsCount:0,pathErrorAttemptsForDisplayMessage:3,hintPath:[],isHint:!1,wasHinted:!1,startMoment:null,lastGuessedMoment:null,events:{guessed:"puzzle.events.guessed",success:"puzzle.events.success",error:"puzzle.events.error"},statuses:{waiting:1,selecting:2,selected:3,finish:4,pause:5},init:function(t,e){var s=this;this.addCustomEvents(),this.configPuzzle(t),this.handleData(e),this.createPlayground(),this.staturs=this.statuses.pause,t=null,e=null,this.getCoords=this.getCanvasCoords(),document.addEventListener("mouseup",function(){return s.mouseUpHandler()}),document.addEventListener("touchend",function(){return s.mouseUpHandler()})},addCustomEvents:function(){try{new CustomEvent("")}catch(t){window.CustomEvent=function(t,e){var s;return e=e||{bubbles:!1,cancelable:!1,detail:void 0},(s=document.createEvent("CustomEvent")).initCustomEvent(t,e.bubbles,e.cancelable,e.detail),s},CustomEvent.prototype=Object.create(window.Event.prototype)}},initEvent:function(t,e){e=e||{a:"hello"};t=new CustomEvent(l.events[t],{detail:e});this.$.dispatchEvent(t)},getCanvasCoords:function(){var t=this.canvas,e=t.getBoundingClientRect(),s=function(){e=t.getBoundingClientRect(),console.log("update coords")};return document.addEventListener("scroll",s),window.addEventListener("resize",s),function(){return e}},configPuzzle:function(t){if(this.$=t.puzzle,this.canvas=t.canvas,this.ctx=t.ctx,!this.ctx)throw new Error("No canva's context");this.$.style.position="relative",this.$.style.display="inline-block",this.$.style.fontSize=0,t.borderWidth&&(this.border=t.borderWidth),t.cellSize&&(this.size=t.cellSize),o.default.border=this.border,o.default.size=this.size,t.mainBorderColor&&(this.mainBorderColor=t.mainBorderColor),t.mainTextColor&&(this.mainTextColor=t.mainTextColor),t.selectedBorderColor&&(this.selectedBorderColor=t.selectedBorderColor),t.selectedTextColor&&(this.selectedTextColor=t.selectedTextColor),t.hintBorderColor&&(this.hintBorderColor=t.hintBorderColor),t.hintTextColor&&(this.hintTextColor=t.hintTextColor),t.canvasPadding&&(this.canvasPadding=t.canvasPadding),this.ctx.font=t.fontSize||"30px Arial",this.ctx.lineWidth=o.default.borderWidth,this.ctx.strokeStyle=this.mainBorderColor,this.ctx.textAlign="center",this.font=t.font,o.default.ctx=this.ctx},handleData:function(t){this.puzzleData=t,this.puzzleData.realWords=this.puzzleData.words_string.split(",")},createPlayground:function(){var t=this.canvasPadding,e=this.puzzleData.cells,s=e.length,i=e[0].length;this.canvas.width=i*this.size+2*t,this.canvas.height=s*this.size+2*t,this.ctx.translate(t,t);for(var r=0;r<s;r++){this.cells[r]=[];for(var n=0;n<i;n++){var l=new o.default({letter:e[r][n],x:n,y:r,padding:this.canvasPadding});l.draw(this.mainBorderColor,this.mainTextColor),this.handleCell(l),this.cells[r][n]=l}}this.playgroundSize={rows:s,cols:i}},handleCell:function(t){var e=this;this.$.appendChild(t.$),t.$.addEventListener("mousedown",function(s){s.preventDefault(),e.mouseDownHandler(t)}),t.$.addEventListener("touchstart",function(s){s.preventDefault(),e.mouseDownHandler(t)}),t.$.addEventListener("mouseover",function(s){s.preventDefault(),e.mouseOverHandler(t)}),t.$.addEventListener("touchmove",function(s){s.preventDefault(),e.touchMoveHandler(t)})},mouseDownHandler:function(t){this.status===this.statuses.waiting&&(t.prop("selected")||t.prop("empty")||(this.status=this.statuses.selecting,this.addCellToSelection(t)))},mouseOverHandler:function(t){if(this.status===this.statuses.selecting&&(console.log("mouse over"),!(t=$(e.currentTarget)).prop("empty")&&this.currentCell)){var s=t.prop("x"),i=t.prop("y");t.prop("selected")?s===this.prevCell.x&&i===this.prevCell.y&&this.resetLastCell():(s===this.currentCell.x&&1===Math.abs(i-this.currentCell.y)||i===this.currentCell.y&&1===Math.abs(s-this.currentCell.x))&&this.addCellToSelection(t)}},touchMoveHandler:function(t){if(this.status===this.statuses.selecting){e.preventDefault(),e.stopPropagation();var s=e.originalEvent.touches[0];if(!(t=$(document.elementFromPoint(s.clientX,s.clientY))).prop("empty")&&this.currentCell){var i=t.prop("x"),r=t.prop("y");i===this.currentCell.x&&r===this.currentCell.y||!t.prop("selected")?(i===this.currentCell.x&&1===Math.abs(r-this.currentCell.y)||r===this.currentCell.y&&1===Math.abs(i-this.currentCell.x))&&this.addCellToSelection(t):i===this.prevCell.x&&r===this.prevCell.y&&this.resetLastCell()}}},mouseUpHandler:function(t){this.status===this.statuses.selecting&&(this.status=this.statuses.selected,this.checkSelection())},resetLastCell:function(){if(this.removeCellFromSelection(this.currentCell.$),this.currentCell=this.prevCell,this.currentWord=this.currentWord.slice(0,this.currentWord.length-1),this.currentSelection.length=this.currentSelection.length-1,this.currentSelection.length<2)this.prevCell=null;else{var t=this.currentSelection[this.currentSelection.length-2];this.prevCell={x:t[0],y:t[1],$:this.cells[t[1]][t[0]]}}},addCellToSelection:function(t){var e=t.prop("x"),s=t.prop("y");this.currentSelection.push([e,s]),this.currentWord+=t.prop("letter"),this.setBorders(this.currentCell,{x:e,y:s,$:t},"data-empty"),t.prop("selected",!0).addClass("selected"),this.prevCell=this.currentCell,this.currentCell={x:e,y:s,$:t}},removeCellFromSelection:function(t){t.prop("selected",!1).removeClass("selected")},emptyCell:function(t){t.prop("selected",!1).prop("empty",!0).removeClass("selected").text("")},checkSelection:function(t){var e=this.currentSelection.join(";"),s=this.currentWord,i=this.words.indexOf(e);-1==i&&(e=this.currentSelection.reverse().join(";"),(i=this.words.indexOf(e))>-1&&(s=this.currentWord.split("").reverse().join(""))),i>-1?this.guessHandler(s,i):(this.isPathError(s)||this.checkWrongWordCount(s),this.clearSelection())},isPathError:function(t){var e=this.puzzleData.realWords.indexOf(t);return-1===e&&(t=t.split("").reverse().join(""),e=this.puzzleData.realWords.indexOf(t)),-1===e?(this.pathErrorAttemptsCount=0,!1):(this.checkPathErrorCount(t),!0)},checkPathErrorCount:function(t){t!==this.lastPathErrorWord&&(this.lastPathErrorWord=t,this.pathErrorAttemptsCount=0),this.pathErrorAttemptsCount++,this.pathErrorAttemptsCount>=this.pathErrorAttemptsForDisplayMessage&&(this.sendEvent("error",{errorType:"path"}),this.displayPathErrorMessage(t))},checkWrongWordCount:function(t){t!==this.lastWrongWord&&(this.lastWrongWord=t,this.wrongAttemptsCount=0),this.wrongAttemptsCount++,this.wrongAttemptsCount>=this.wrongAttemptsForDisplayMessage&&(this.sendEvent("error",{errorType:"word"}),this.displayWrongMessage(t))},emptySelection:function(){for(var t=0,e=this.currentSelection.length;t<e;t++){var s=this.currentSelection[t],i=this.cells[s[1]][s[0]];this.emptyCell(i)}this.currentSelection.length=0,this.currentCell=null,this.currentWord="",this.status=this.statuses.waiting},clearSelection:function(){for(var t=0,e=this.currentSelection.length;t<e;t++){var s=this.currentSelection[t],i=this.cells[s[1]][s[0]];this.removeCellFromSelection(i)}this.currentSelection.length=0,this.currentCell=null,this.prevCell=null,this.currentWord="",this.status=l.statuses.waiting},displayWrongMessage:function(t){this.wrongAttemptsCount=0,alert("������: "+t)},displayPathErrorMessage:function(t){this.pathErrorAttemptsCount=0,alert("������ (����): "+t)},guessHandler:function(t,e){this.lastWrongWord="",this.wrongAttemptsCount=0,this.lastPathErrorWord="",this.wrongAttemptsCount=0,this.count++;var s=Date.now(),i=s-this.lastGuessedMoment;this.lastGuessedMoment=s,this.sendEvent("guessed",{guessedWord:t,guessedCount:this.count,currentTime:i/1e3}),this.showWord(t),this.emptySelection(),this.isHint&&e==this.puzzleData.hint&&this.clearHint(),this.guessedWords[e]=!0,-1==this.guessedWords.indexOf(!1)&&this.success()},showWord:function(t){(t=t.split(""))[0]=t[0].toUpperCase(),t=t.join(""),this.$words[this.count-1].text(t)},success:function(){this.sendEvent("success",{totalTime:(Date.now()-this.startMoment)/1e3}),this.hintTrigger.detach(),this.status=0,this.onSuccess&&this.onSuccess()},getHint:function(){if(!this.wasHinted&&this.status===this.statuses.waiting&&(this.guessedWords[this.puzzleData.hint]&&(this.puzzleData.hint=this.guessedWords.indexOf(!1)),-1!=this.puzzleData.hint)){var t;this.hintPath=this.words[this.puzzleData.hint].split(";"),this.isHint=!0,this.wasHinted=!0,this.status=l.statuses.pause;for(var e=0,s=this.hintPath.length;e<s;e++){var i=this.hintPath[e].split(","),r=this.cells[i[1]][i[0]];this.setBorders(t,{x:i[0],y:i[1],$:r},"data-hint-empty"),r.addClass("hinted"),t={x:i[0],y:i[1],$:r}}this.sendEvent("hint",{hintTime:(Date.now()-this.startMoment)/1e3}),this.status=this.statuses.waiting,this.removeHint()}},clearHint:function(){this.isHint=!1;for(var t=0,e=this.hintPath.length;t<e;t++){var s=this.hintPath[t].split(",");this.cells[s[1]][s[0]].removeClass("hinted")}},removeHint:function(){this.hintTrigger.detach()},start:function(){this.status=this.statuses.waiting,this.startMoment=Date.now(),this.lastGuessedMoment=this.startMoment}};s.default=l},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(s(2)),r=n(s(0));function n(t){return t&&t.__esModule?t:{default:t}}var o={couponBlock:null,coupontText:null,wordsField:null,hint:null,$puzzle:null,puzzle:i.default,analytics:r.default,init:function(t,e,s){var r=this;this.$puzzle=t.puzzle,this.$puzzle.addEventListener(i.default.events.guessed,function(t){r.guessedHandler(t.detail)}),this.$puzzle.addEventListener(i.default.events.success,function(t){thatsuccessHandler(t.detail)}),this.puzzle.init(t,e),this.puzzle.start()},guessedHandler:function(t){console.log("gueesed handler",t)},successHandler:function(t){}};e.default=o},function(t,e,s){"use strict";var i,r=s(3),n=(i=r)&&i.__esModule?i:{default:i};console.log(n.default)}]);